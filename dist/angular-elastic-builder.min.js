!function(e){"use strict";e.module("angular-elastic-builder",["RecursionHelper"])}(window.angular),function(e){"use strict";e.module("angular-elastic-builder").directive("elasticBuilder",["elasticQueryService",function(e){return{scope:{data:"=elasticBuilder"},templateUrl:"angular-elastic-builder/BuilderDirective.html",link:function(t){var r=t.data;t.filters=[],t.removeChild=function(e){t.filters.splice(e,1)},t.addRule=function(){t.filters.push({})},t.addGroup=function(){t.filters.push({type:"group",subType:"and",rules:[]})},t.$watch("data.needsUpdate",function(a){if(a){if(n(r.query.query.constant_score.filter.and))throw new Error("Define a base query like: query.constant_score.filter.and = []");t.filters=e.toFilters(r.query.query.constant_score.filter.and,t.data.fields),t.data.needsUpdate=!1}}),t.$watch("filters",function(n){if(n){var a=e.toQuery(t.filters,t.data.fields);r.query={query:{constant_score:{filter:{and:a}}}}}},!0);var n=function(e){try{JSON.parse(JSON.stringify(e))}catch(t){return!0}return!1}}}}])}(window.angular),function(e){"use strict";var t=e.module("angular-elastic-builder");t.directive("elasticBuilderChooser",["RecursionHelper","groupClassHelper",function(e,t){return{scope:{elasticFields:"=",item:"=elasticBuilderChooser",onRemove:"&"},templateUrl:"angular-elastic-builder/ChooserDirective.html",compile:function(r){return e.compile(r,function(e,r,n){var a=e.depth=+n.depth,i=e.item;e.getGroupClassName=function(){var e=a;return"group"===i.type&&e++,t(e)}})}}}])}(window.angular),function(e){"use strict";var t=e.module("angular-elastic-builder");t.directive("elasticBuilderGroup",["RecursionHelper","groupClassHelper",function(e,t){return{scope:{elasticFields:"=",group:"=elasticBuilderGroup",onRemove:"&"},templateUrl:"angular-elastic-builder/GroupDirective.html",compile:function(r){return e.compile(r,function(e,r,n){var a=e.depth=+n.depth,i=e.group;e.addRule=function(){i.rules.push({})},e.addGroup=function(){i.rules.push({type:"group",subType:"and",rules:[]})},e.removeChild=function(e){i.rules.splice(e,1)},e.getGroupClassName=function(){return t(a+1)}})}}}])}(window.angular),function(e){"use strict";var t=e.module("angular-elastic-builder");t.directive("elasticBuilderRule",[function(){return{scope:{elasticFields:"=",rule:"=elasticBuilderRule",onRemove:"&"},templateUrl:"angular-elastic-builder/RuleDirective.html",link:function(e){e.getType=function(){var t=e.elasticFields,r=e.rule.field;if(t&&r)return t[r].type},e.initRule=function(){var r=e.rule;switch(r.subType="equals",e.getType()){case"term":case"boolean":r.value="";break;case"number":r.value=0;break;case"date":r.value=0,r.date=t();break;case"multi":r.value=[];break;default:throw new Error("Unexpected type!")}};var t=function(){var e=new Date;return e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear()}},controller:function(e){e.uiSelectOptions={dropdownAutoWidth:!0}}}}])}(window.angular),function(e){"use strict";var t=e.module("angular-elastic-builder");t.directive("elasticType",[function(){return{scope:{type:"=elasticType",rule:"=",guide:"="},template:'<ng-include src="getTemplateUrl()" />',link:function(e){e.getTemplateUrl=function(){var t=e.type;if(t)return t=t.charAt(0).toUpperCase()+t.slice(1),"angular-elastic-builder/types/"+t+".html"},e.booleans=[{value:"S",description:"Sim"},{value:"N",description:"NÃ£o"}],e.inputNeeded=function(){var t=["equals","notEquals","prefix","contains","last","next","gt","gte","lt","lte"];return~t.indexOf(e.rule.subType)},e.dateNeeded=function(){var t=["equals","gt","gte","lt","lte"];return~t.indexOf(e.rule.subType)},e.numberNeeded=function(){var t=["last","next"];return~t.indexOf(e.rule.subType)}},controller:function(e){e.uiSelectOptions={dropdownAutoWidth:!0}}}}])}(window.angular),function(e){"use strict";e.module("angular-elastic-builder").run(["$templateCache",function(e){e.put("angular-elastic-builder/BuilderDirective.html",'<div class="elastic-builder">\r\n  <div class="filter-panels">\r\n    <div class="list-group form-inline">\r\n      <div\r\n        data-ng-repeat="filter in filters"\r\n        data-elastic-builder-chooser="filter"\r\n        data-elastic-fields="data.fields"\r\n        data-on-remove="removeChild($index)"\r\n        data-depth="0"></div>\r\n      <div class="list-group-item actions">\r\n        <a class="btn btn-xs btn-primary" title="Add Rule" data-ng-click="addRule()">\r\n          <i class="fa fa-plus"></i>\r\n        </a>\r\n        <a class="btn btn-xs btn-primary" title="Add Group" data-ng-click="addGroup()">\r\n          <i class="fa fa-list"></i>\r\n        </a>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'),e.put("angular-elastic-builder/ChooserDirective.html",'<div\r\n  class="list-group-item elastic-builder-chooser"\r\n  data-ng-class="getGroupClassName()">\r\n\r\n  <div data-ng-if="item.type === \'group\'"\r\n    data-elastic-builder-group="item"\r\n    data-depth="{{ depth }}"\r\n    data-elastic-fields="elasticFields"\r\n    data-on-remove="onRemove()"></div>\r\n\r\n  <div data-ng-if="item.type !== \'group\'"\r\n    data-elastic-builder-rule="item"\r\n    data-elastic-fields="elasticFields"\r\n    data-on-remove="onRemove()"></div>\r\n\r\n</div>\r\n'),e.put("angular-elastic-builder/GroupDirective.html",'<div class="elastic-builder-group">\r\n  <h7>Se\r\n    <select data-ng-model="group.subType" ui-select2>\r\n      <option value=and>todas</option>\r\n      <option value="or">alguma</option>\r\n    </select>\r\n    (d)as condi&ccedil;&otilde;es forem satisfeitas\r\n  </h7>\r\n  <div\r\n    data-ng-repeat="rule in group.rules"\r\n    data-elastic-builder-chooser="rule"\r\n    data-elastic-fields="elasticFields"\r\n    data-depth="{{ +depth + 1 }}"\r\n    data-on-remove="removeChild($index)"></div>\r\n\r\n  <div class="list-group-item actions" data-ng-class="getGroupClassName()">\r\n    <a class="btn btn-xs btn-primary" title="Adicionar regra" data-ng-click="addRule()">\r\n      <i class="fa fa-plus"></i>\r\n    </a>\r\n    <a class="btn btn-xs btn-primary" title="Adicionar grupo" data-ng-click="addGroup()">\r\n      <i class="fa fa-list"></i>\r\n    </a>\r\n    <a class="btn btn-xs btn-danger remover" data-ng-click="onRemove()">\r\n      <i class="fa fa-minus"></i>\r\n    </a>\r\n  </div>\r\n\r\n</div>\r\n'),e.put("angular-elastic-builder/RuleDirective.html",'<div class="elastic-builder-rule">\r\n  <select data-ui-select2="uiSelectOptions" data-ng-model="rule.field" data-ng-change="initRule()">\r\n  	<option data-ng-repeat="(key, value) in elasticFields" value="{{ key }}">{{ value.description }}</option>\r\n  </select>\r\n\r\n  <span data-elastic-type="getType()" data-rule="rule" data-guide="elasticFields[rule.field]"></span>\r\n\r\n  <a class="btn btn-xs btn-danger remover" data-ng-click="onRemove()">\r\n    <i class="fa fa-minus"></i>\r\n  </a>\r\n\r\n</div>\r\n'),e.put("angular-elastic-builder/types/Boolean.html",'<span class="boolean-rule">\r\n  <select data-ng-model="rule.subType" data-ui-select2="uiSelectOptions">\r\n    <!-- Term Options -->\r\n    <optgroup label="Texto">\r\n      <option value="equals">Igual</option>\r\n    </optgroup>\r\n\r\n    <!-- Generic Options -->\r\n    <optgroup label="Gen&eacute;rico">\r\n      <option value="exists">Existe</option>\r\n      <option value="notExists">N&atilde;o existe</option>\r\n    </optgroup>\r\n  </select>\r\n\r\n  <select data-ui-select2="uiSelectOptions" data-ng-if="inputNeeded()" data-ng-model="rule.value">\r\n	<option data-ng-repeat="choice in booleans" value="{{ choice.value }}">{{ choice.description }}</option>\r\n  </select>\r\n</span>\r\n'),e.put("angular-elastic-builder/types/Date.html",'<span class="date-rule">\r\n  <select data-ng-model="rule.subType" data-ui-select2="uiSelectOptions">\r\n\r\n    <optgroup label="Per&iacute;odo">\r\n      <option value="last">Nos &uacute;ltimos</option>\r\n      <option value="next">Nos pr&oacute;ximos</option>\r\n    </optgroup>\r\n\r\n    <optgroup label="Data">\r\n      <option value="equals">=</option>\r\n      <option value="gt">&gt;</option>\r\n      <option value="gte">&ge;</option>\r\n      <option value="lt">&lt;</option>\r\n      <option value="lte">&le;</option>\r\n    </optgroup>\r\n\r\n    <optgroup label="Gen&eacute;rico">\r\n      <option value="exists">Existe</option>\r\n      <option value="notExists">N&atilde;o existe</option>\r\n    </optgroup>\r\n  </select>\r\n\r\n  <span data-ng-if="numberNeeded()"><input type="number" class="form-control"\r\n    data-ng-model="rule.value" min=0 size="3" /> dias</span>\r\n\r\n  <input type="text" class="form-control" data-ng-if="dateNeeded()" data-provide="datepicker" data-date-format="dd/mm/yyyy"\r\n    data-ng-model="rule.date" data-ng-init="init(rule.date,\'\')" />\r\n\r\n</span>\r\n'),e.put("angular-elastic-builder/types/Multi.html",'<span class="multi-rule">\r\n  <select data-ng-model="rule.subType" data-ui-select2="uiSelectOptions">\r\n  \r\n    <optgroup label="Texto">\r\n      <option value="equals">Igual</option>\r\n      <option value="notEquals">Diferente</option>\r\n    </optgroup>\r\n    \r\n    <optgroup label="Gen&eacute;rico">\r\n      <option value="exists">Existe</option>\r\n      <option value="notExists">N&atilde;o existe</option>\r\n    </optgroup>\r\n  </select>\r\n  <select multiple="multiple" data-ui-select2="uiSelectOptions"\r\n  	data-ng-multiple="true" data-ng-if="inputNeeded()" data-ng-model="rule.value">\r\n	<option data-ng-repeat="choice in guide.choices" value="{{ choice.value }}">{{ choice.description }}</option>\r\n  </select>\r\n</span>\r\n'),e.put("angular-elastic-builder/types/Number.html",'<span class="number-rule">\r\n  <select data-ng-model="rule.subType" data-ui-select2="uiSelectOptions">\r\n    <optgroup label="Numeral">\r\n      <option value="equals">=</option>\r\n      <option value="notEquals">!=</option>\r\n      <option value="gt">&gt;</option>\r\n      <option value="gte">&ge;</option>\r\n      <option value="lt">&lt;</option>\r\n      <option value="lte">&le;</option>\r\n    </optgroup>\r\n\r\n    <optgroup label="Gen&eacute;rico">\r\n      <option value="exists">Existe</option>\r\n      <option value="notExists">N&atilde;o existe</option>\r\n    </optgroup>\r\n  </select>\r\n\r\n  <!-- Range Fields -->\r\n  <input type="number" class="form-control" data-ng-if="inputNeeded()"\r\n    data-ng-model="rule.value" min="{{ guide.minimum }}" max="{{ guide.maximum }}" />\r\n</span>\r\n'),e.put("angular-elastic-builder/types/Term.html",'<span class="elastic-term">\r\n  <select data-ng-model="rule.subType" data-ui-select2="uiSelectOptions">\r\n    <!-- Term Options -->\r\n    <optgroup label="Texto">\r\n      <option value="equals">Igual</option>\r\n      <option value="notEquals">Diferente</option>\r\n      <option value="prefix">Come&ccedil;a</option>\r\n      <option value="contains">Cont&eacute;m</option>\r\n    </optgroup>\r\n\r\n    <!-- Generic Options -->\r\n    <optgroup label="Gen&eacute;rico">\r\n      <option value="exists">Existe</option>\r\n      <option value="notExists">N&atilde;o existe</option>\r\n    </optgroup>\r\n\r\n  </select>\r\n  <input class="form-control" type="text" data-ng-if="inputNeeded()"\r\n   data-ng-model="rule.value" />\r\n</span>\r\n')}])}(window.angular),function(e){"use strict";e.module("angular-elastic-builder").factory("groupClassHelper",function(){return function(e){var t=["","list-group-item-info","list-group-item-success","list-group-item-warning","list-group-item-danger"];return t[e%t.length]}})}(window.angular),function(e){"use strict";function t(e,t){var r=e.map(n.bind(e,t));return r}function r(e,t){var r=e.map(a.bind(e,t)).filter(function(e){return!!e});return r}function n(t,r,a){a!==!1&&(a=!0);var l=Object.keys(r)[0],u={or:"group",and:"group",range:"number"},s=u[l]||"item",o=i(s);switch(l){case"or":case"and":o.rules=r[l].map(n.bind(r,t)),o.subType=l;break;case"missing":case"exists":o.field=r[l].field,o.subType={exists:"exists",missing:"notExists"}[l],delete o.value;break;case"term":case"terms":o.field=Object.keys(r[l])[0],o.subType=a?"equals":"notEquals",o.value=r[l][o.field];break;case"regexp":o.field=Object.keys(r[l])[0],o.subType="contains",o.value=r[l][o.field].replace(".*","").replace("(?i)","");break;case"prefix":o.field=Object.keys(r[l])[0],o.subType="prefix",o.value=r[l][o.field];break;case"range":if(o.field=Object.keys(r[l])[0],o.subType=Object.keys(r[l][o.field])[0],e.isNumber(r[l][o.field][o.subType]))o.value=r[l][o.field][o.subType];else if(e.isDefined(Object.keys(r[l][o.field])[1])){var p=r[l][o.field].gte;if(p.indexOf("now-")>-1)o.subType="last",o.value=parseInt(p.split("now-")[1].split("d")[0]);else if(p.indexOf("now")>-1)o.subType="next",p=r[l][o.field].lte,o.value=parseInt(p.split("now+")[1].split("d")[0]);else{o.subType="equals";var c=p.split("T")[0].split("-");o.date=c[2]+"/"+c[1]+"/"+c[0]}}else{var p=r[l][o.field][o.subType],c=p.split("T")[0].split("-");o.date=c[2]+"/"+c[1]+"/"+c[0]}break;case"not":o=n(t,r[l].filter,!1);break;default:o.field=Object.keys(r[l])[0]}return o}function a(t,r){var n={};if("group"===r.type)return n[r.subType]=r.rules.map(a.bind(r,t)).filter(function(e){return!!e}),n;var i=r.field,o=t[i];if(i&&r.subType){switch(r.subType){case"exists":n.exists={field:i};break;case"notExists":n.missing={field:i};break;case"equals":if("date"===o.type)break;if(u(r.value))return;e.isArray(r.value)?(n.terms={},n.terms[i]=r.value):(n.term={},n.term[i]=r.value);break;case"notEquals":if(u(r.value))return;e.isArray(r.value)?(n.not={filter:{terms:{}}},n.not.filter.terms[i]=r.value):(n.not={filter:{term:{}}},n.not.filter.term[i]=r.value)}switch(o.type){case"boolean":case"term":switch(r.subType){case"prefix":if(u(r.value))return;n.prefix={},n.prefix[i]=r.value;break;case"contains":if(u(r.value))return;n.regexp={},n.regexp[i]=".*(?i)"+r.value+".*"}break;case"number":if(l(r.value))return;if("equals"===r.subType||"notEquals"===r.subType)break;n.range={},n.range[i]={},n.range[i][r.subType]=r.value;break;case"date":switch(r.subType){case"last":if(l(r.value))return;n.range={},n.range[i]={},n.range[i].gte="now-"+r.value+"d",n.range[i].lte="now";break;case"next":if(l(r.value))return;n.range={},n.range[i]={},n.range[i].gte="now",n.range[i].lte="now+"+r.value+"d";break;case"equals":var p=s(r.date);if(!p)return;n.range={},n.range[i]={},n.range[i].gte=p+"T00:00:00",n.range[i].lte=p+"T23:59:59";break;case"gt":case"gte":var p=s(r.date);if(!p)return;n.range={},n.range[i]={},n.range[i][r.subType]=p+"T00:00:00";break;case"lt":case"lte":var p=s(r.date);if(!p)return;n.range={},n.range[i]={},n.range[i][r.subType]=p+"T23:59:59"}break;case"multi":break;default:throw new Error("Unexpected type")}return n}}function i(t){var r={group:{type:"group",subType:"",rules:[]},item:{field:"",subType:"",value:""},number:{field:"",subType:"",value:null}};return e.copy(r[t])}function l(e){return void 0===e||null===e||Number.isNaN(e)}function u(e){return void 0===e||null===e}function s(t){if(!e.isString(t))return!1;var r=t.split("/"),n=r[2]+"-"+r[1]+"-"+r[0],a=Date.parse(n);return Number.isNaN(a)?!1:n}e.module("angular-elastic-builder").factory("elasticQueryService",[function(){return{toFilters:t,toQuery:r}}])}(window.angular);